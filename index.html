<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Game of Life</title>
        <link href="stillshit.css" type="text/css" rel="stylesheet" />
    </head>
    <body class="laboratory">
        <div id="sample-table">
            <button id="btn_playpause">Start</button>
            <button id="btn_nextStep">Next step</button>
            <button id="btn_erase">Erase</button>

        </div>

        <script src="node_modules/p5/lib/p5.min.js"></script>
        <script src="node_modules/jquery/dist/jquery.min.js"></script>
        <script src="Cell.js"></script>
        <script src="PetriPlate.js"></script>
        <script>
            var loop; isPlayed = false;

            var sample = new PetriPlate(50);

            $('#btn_erase').click(()=>{
                isPlayed = false;
                for(let i = 0 ; i < sample.size; i++){
                    for(let j = 0 ; j < sample.size; j++){
                        sample.cells[i][j].state = Cell.STATE_DEAD;
                    }
                }
                sample.generationNumber = 0;
            });

            $('#btn_playpause').click(()=>{
                isPlayed = !isPlayed;
            });

            $('#btn_nextStep').click(()=>{
                isPlayed = false;
                sample.nextStep();
            });

            function setup() {
                const CANVAS_SIZE = displayWidth/2;

                let canvas = createCanvas(CANVAS_SIZE, CANVAS_SIZE);
                canvas.position(CANVAS_SIZE/4, 0);
                canvas.parent('sample-table');
                background(200, 200, 200);
            }

            var previousCellUnderMouse = null;

            function draw() {
                sample.draw();
                $('#btn_playpause').text(isPlayed ? 'Pause' : 'Play');
                if(isPlayed) {
                    sample.nextStep();
                }

                let currentCellUnderMouse = getCellUnderMouse();

                if(mouseIsPressed && currentCellUnderMouse !== null && currentCellUnderMouse !== previousCellUnderMouse){
                    currentCellUnderMouse.state = currentCellUnderMouse.state === Cell.STATE_ALIVE ? Cell.STATE_DEAD : Cell.STATE_ALIVE;
                    previousCellUnderMouse = currentCellUnderMouse;
                }
            }

            function getCellUnderMouse() {
                if(mouseX > 0 && mouseY > 0){
                    let indexX = ceil(mouseY / Cell.WIDTH)-1;
                    let indexY = ceil(mouseX / Cell.WIDTH)-1;
                    if(indexX < sample.size && indexY < sample.size) {
                        //console.log(indexX,indexY, sample.cells[indexX][indexY]);
                        return sample.cells[indexX][indexY];
                    }
                }
                return null;
            }

        </script>
    </body>
</html>